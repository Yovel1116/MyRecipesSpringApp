<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Management</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

</head>
<body class="bg-light">

<div class="container mt-4" style="max-width: 600px; margin: auto;" >
    <h1 class="text-center text-primary mb-4">Employee Management</h1>

    <!-- Employee List -->
    <div class="card shadow mb-4">
        <div class="card-header bg-primary text-white">
            <h2 class="h5 mb-0">Employee List</h2>
        </div>
        <div class="card-body">
            <ul id="employeeList" class="list-group"></ul>
        </div>
    </div>

    <!-- Add New Employee -->
    <div class="card shadow mb-4">
        <div class="card-header bg-success text-white">
            <h2 class="h5 mb-0">Add New Employee</h2>
        </div>
        <div class="card-body">
            <form id="employeeForm">
                <div class="mb-3">
                    <input type="text" id="firstName" class="form-control" placeholder="First Name" required>
                </div>
                <div class="mb-3">
                    <input type="text" id="lastName" class="form-control" placeholder="Last Name" required>
                </div>
                <div class="mb-3">
                    <input type="email" id="email" class="form-control" placeholder="Email" required>
                </div>
                <button type="submit" class="btn btn-success w-100">Add Employee</button>
            </form>
        </div>
    </div>

    <!-- Update Employee -->
    <div class="card shadow mb-4">
        <div class="card-header bg-warning text-dark">
            <h2 class="h5 mb-0">Update Employee</h2>
        </div>
        <div class="card-body">
            <form id="updateForm">
                <div class="mb-3">
                    <input type="number" id="updateId" class="form-control" placeholder="Employee ID" required>
                </div>
                <div class="mb-3">
                    <input type="text" id="updateFirstName" class="form-control" placeholder="New First Name">
                </div>
                <div class="mb-3">
                    <input type="text" id="updateLastName" class="form-control" placeholder="New Last Name">
                </div>
                <div class="mb-3">
                    <input type="email" id="updateEmail" class="form-control" placeholder="New Email">
                </div>
                <button type="submit" class="btn btn-warning w-100">Update Employee</button>
            </form>
        </div>
        <!-- Delete Employee -->
        <div class="card shadow mb-4">
            <div class="card-header bg-danger text-white">
                <h2 class="h5 mb-0">Delete Employee</h2>
            </div>
            <div class="card-body">
                <form id="deleteForm">
                    <div class="mb-3">
                        <input type="number" id="deleteId" class="form-control" placeholder="Employee ID" required>
                    </div>
                    <button type="submit" class="btn btn-danger w-100">Delete Employee</button>
                </form>
            </div>
        </div>

    </div>
</div>

<!-- Bootstrap 5 JS Bundle (for interactive components) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    const API_URL = "http://localhost:8080/api/members"; // Adjust if needed

    // Fetch and display all employees
    function fetchEmployees() {
        fetch(API_URL)
            .then(response => response.json())
            .then(data => {
                console.log("API Response:", data);

                const employeeList = document.getElementById("employeeList");
                employeeList.innerHTML = ""; // Clear the list

                const employees = data._embedded ? data._embedded.employees : [];

                if (employees.length > 0) {
                    employees.forEach(employee => {
                        console.log("Employee Object:", employee);

                        // Extract ID from "_links.self.href"
                        const id = employee._links?.self?.href.split("/").pop() || "No ID";

                        const li = document.createElement("li");
                        li.classList.add("list-group-item", "text-start");
                        li.innerHTML = `<strong>${id}:</strong> ${employee.firstName} ${employee.lastName} - ${employee.email}`;
                        employeeList.appendChild(li);
                    });
                } else {
                    console.error("No employees found:", employees);
                }
            })
            .catch(error => console.error("Error fetching employees:", error));
    }

    // Add new employee
    document.getElementById("employeeForm").addEventListener("submit", function(event) {
        event.preventDefault();

        const employee = {
            firstName: document.getElementById("firstName").value,
            lastName: document.getElementById("lastName").value,
            email: document.getElementById("email").value
        };

        fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(employee)
        })
            .then(response => response.json())
            .then(() => {
                fetchEmployees();
                document.getElementById("employeeForm").reset();
            })
            .catch(error => console.error("Error adding employee:", error));
    });

    // Update an existing employee
    document.getElementById("updateForm").addEventListener("submit", function(event) {
        event.preventDefault();

        const employeeId = document.getElementById("updateId").value;
        const updatedEmployee = {
            firstName: document.getElementById("updateFirstName").value,
            lastName: document.getElementById("updateLastName").value,
            email: document.getElementById("updateEmail").value
        };

        fetch(`${API_URL}/${employeeId}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(updatedEmployee)
        })
            .then(response => response.json())
            .then(() => {
                fetchEmployees();
                document.getElementById("updateForm").reset();
            })
            .catch(error => console.error("Error updating employee:", error));
    });
    // Delete an employee by ID
    document.getElementById("deleteForm").addEventListener("submit", function(event) {
        event.preventDefault();

        const employeeId = document.getElementById("deleteId").value;

        fetch(`${API_URL}/${employeeId}`, {
            method: "DELETE"
        })
            .then(() => {
                fetchEmployees(); // Refresh the list after deletion
                document.getElementById("deleteForm").reset();
            })
            .catch(error => console.error("Error deleting employee:", error));
    });

    // Load employees when the page loads
    fetchEmployees();

</script>

</body>
</html>
